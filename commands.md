# Навигация
* [README.md](README.md) - введение, характеристики, готовые программы, дополнительная литература
* [structure.md](structure.md) - комплектация компьютера, структура и характеристики его частей
* [starting-and-floppies.md](starting-and-floppies.md) - как запустить программу, генерация дискет
* **[commands.md](commands.md) - система команд PDP-8**

# Система команд PDP-8
У компьютера есть 8 основных команд: 6 команд обращения к памяти, 1 команда обращения к внешним устройствам, 1 команда микропрограммирования.

## Команды обращения к памяти
Используются для работы с памятью (как ни странно), выполнения переходов и операций с двумя операндами.

Один куб на 4096 слов делится на 32 страницы памяти, в каждой по 128 слов.

Первые 3 бита команды являются кодом основной команды, следующий бит означает косвенную адресацию к ячейке (в адресуемой ячейке находится полный адрес на другую ячейку, из которой надо взять данные), следующий бит говорит об использовании текущей страницы памяти (1 - текущая,  0 - нулевая страница), последние 7 бит — адрес на странице памяти.

Список команд с их кодами:
* 0 - AND - побитовое И между аккумулятором и значением ячейки памяти, сохранение результата в аккумуляторе
* 1 - TAD - сложение между аккумулятором и значением ячейки памяти, сохранение результата в аккумуляторе
* 2 - ISZ - увеличение значения ячейки на 1, и если оно становится равным 0, пропуск следующей команды
* 3 - DAC - запись содержимого аккумулятора в ячейку памяти
* 4 - JMS - обращение к подпрограмме: запись содержимого счётчика команд в ячейку и переход к следующей после указанной в команде ячейке
* 5 - JMP - безусловный переход: установка счётчика команд в указанную ячейку

В ассемблере PAL-III после команды могут идти флаги Z (нулевая страница) и I (косвенная адресация), после чего идёт адрес ячейки.

## Обращение к внешним устройствам
Команды этой группы позволяют отправлять команды периферийным устройствам и получать данные от них.

Первые 3 бита команды всегда равны 6 (в двоичной системе 110), далее идут 6 бит кода устройства, последние 3 бита — код команды, которую надо выполнить устройству.

Некоторые устройства, в их числе клавиатура и терминал, используют особый вид 3-битных команд устройства. Сначала идёт бит, который означает обмен данными между аккумулятором и буфером устройства, следующий бит соответствует гашению флага устройства, а последний — опросу флага. Благодаря такой системе можно за одну команду выполнить несколько действий.

В ассемблере PAL-III есть отдельные команды для некоторых устройств.

Внешние устройства могут давать процессору сигнал на прерывание. После выполнения текущей команды, процессор имитирует обращение к подпрограмме с адресом 0000<sub>8</sub>, то есть выполняет команду 4000<sub>8</sub>: сохраняет текущее содержимое счётчика команд в ячейку с адресом 0000<sub>8</sub> и переходит к выполнению команды с адресом 0001<sub>8</sub>. Программа обработчик прерываний по окончании обработки прерывания должна восстановить работу программы с инструкции, адрес которой сохранён в 0000<sub>8</sub> ячейке.

Также к этой группе команд относятся команды обращения к расширенной памяти (при наличии дополнительных кубов памяти), но мне лень их расписывать, посмотрите в документации к Электронике-100 или официальной PDP-8 (см. [раздел с документациями](README.md#для-продвинутых-пользователей)).

## Микрокоманды
Делятся на 2 группы. Первая выполняет модификации аккумулятора и его дополнительного разряда (инвертирование, инкремент, обнуление, сдвиг и т.д.). Вторая же больше нужная для организации ветвлений в программах (пропуск следующей команды при определённом условии).

Микрокомандам соответствует основная команда с кодом 7, то есть первые 3 бита команды будут единицами. Следующий бит указывает на группу микрокоманд (0 - первая группа, 1 - вторая), значение остальных битов зависит от группы микрокоманд.

![Микрокоманды первой группы. 0 бит - 1, 1 бит - 1, 2 бит - 1, 3 бит - 0, 4 бит - очистка НР, 5 бит - очистка ДР, 6 бит - инвертирование НР, 7 бит - инвертирование ДР, 8 бит - сдвиг влево, 9 бит - сдвиг вправо, 10 бит - (если 0, сдвиг на 1 разряд, если 1, сдвиг на 2 разряда), 11 бит - (НР + 1)](images\microcommands_1.png)

_НР - наполнительный регистр, аккумулятор. ДР - дополнительный разряд, бит переполнения аккумулятора_

![Микрокоманды второй группы. 0 бит - 1, 1 бит - 1, 2 бит - 1, 3 бит - 1, 4 бит - очистка НР, 5 бит - (если 8 бит равен 1, пропуск при условии что НР >= 0, иначе при условии что НР < 0), 6 бит - (если 8 бит равен 1, пропуск при условии что НР != 0, иначе при условии что НР == 0), 7 бит - (если 8 бит равен 1, пропуск при условии что ДР == 0, иначе при условии что ДР == 1), 8 бит - (безусловный пропуск, если равен 1 и никаких дополнительных условий не указано), 9 бит - логическое сложение НР и КР, 10 бит - остановка компьютера, 11 бит - 0](images\microcommands_2.png)

_КР - клавишный регистр НР - наполнительный регистр, аккумулятор. ДР - дополнительный разряд, бит переполнения аккумулятора_

Ко второй группе микрокоманд также относятся команды добавляемого арифметического блока.

![Команды управления добавляемым арифметическим блоком; 0 бит - 1, 1 бит - 1, 2 бит - 1, 3 бит - 1, 4 бит - очистка НР, 5 бит - логическое сложение РМЧ и НР, 6 бит - запись содержимого счётчика шагов в НР, 7 бит - запись в РМЧ, (8 бит, 9 бит, 10 бит) - (010: умножение, 011: деление, 100: нормализация, 101: сдвиг влево, 110: арифметический сдвиг вправо, 111: логический сдвиг вправо), 11 бит - 1](images/microcommands_eae.png)

_НР - наполнительный регистр, аккумулятор. РМЧ - регистр множителя-частного, регистр ДАБ._
